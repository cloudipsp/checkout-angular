!function(){"use strict";angular.module("mx.checkout",["mx/template/checkout/checkout.html","mx/template/checkout/card.html","mx/template/checkout/ibank.html","mx/template/checkout/emoney.html","mx/template/checkout/field-input.html","mx/template/checkout/modal.html"]),angular.module("mx.checkout").constant("mxCheckoutConfig",{fields:{card:{id:"card",text:"Card number",label:!0,size:"19",pattern:"[0-9]{14,19}",valid:"ccard,required"},expireMonth:{id:"expireMonth",placeholder:"MM",text:"Expiration",label:!0,size:"2",pattern:"[0-9]{2}",valid:"exp_date,required",expdate:"expireYear"},expireYear:{id:"expireYear",placeholder:"YY",label:!0,size:"2",pattern:"[0-9]{2}",valid:"exp_date,required",expdate:"expireMonth"},cvv:{id:"cvv",text:"Security Code",label:!0,info:"CVV/CVC2 – this 3-digits are security code. It is located in the signature field on the back of your payment card (last three digits)",size:"3",pattern:"[0-9]{3}",valid:"cvv2,required"}},formMap:["card","expireMonth","expireYear","cvv"],error:{required:"Required field",ccard:"Credit card number is invalid",exp_date:"Invalid expiry date",cvv2:"Incorrect CVV2 format"},defaultData:{tabs:{card:{id:"card",icons:["visa","master","american","discover"]},emoney:{id:"emoney",icons:[]},ibank:{id:"ibank",icons:[]}}},getData:{active_tab:"card",tabs_order:["card","ibank","emoney"],tabs:{card:{name:"Credit or Debit Card"},emoney:{name:"Electronic money",payment_systems:{webmoney:{name:"Webmoney"}}},ibank:{name:"Internet-banking",payment_systems:{p24:{name:"Приват24"},plotva24:{name:"PLATBA 24"}}}}}}),angular.module("mx.checkout").directive("mxCheckout",function(){return{restrict:"A",templateUrl:"mx/template/checkout/checkout.html",scope:{onSubmit:"&"},controller:["$scope","mxCheckout","$element","$attrs",function(a,b,c,d){b.init(),a.data=b.data,a.formSubmit=function(d){return b.formSubmit(a.onSubmit,c,d)},a.selectPaymentSystems=b.selectPaymentSystems,a.stop=b.stop,a.blur=b.blur,a.focus=b.focus}]}}).directive("mxFieldInput",function(){return{restrict:"A",replace:!0,templateUrl:"mx/template/checkout/field-input.html",scope:{model:"=mxFieldInput",config:"=",formCtrl:"=",valid:"=",blur:"&",focus:"&"}}}).directive("autoFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c,d,e){b.$watch(d.autoFocus,function(b){angular.isDefined(b)&&b&&a(function(){c[0].focus()})},!0)}}}]).directive("mxFieldValid",["mxValidation","mxCheckoutConfig",function(a,b){return{restrict:"A",require:"ngModel",scope:{valid:"=mxFieldValid",config:"=",model:"="},link:function(c,d,e,f){function g(a,d){a?c.valid.iconShow[c.config.expdate]=!1:c.valid.errorText[f.$name]=b.error[d],f.$setValidity(d,a)}c.config.valid&&angular.forEach(c.config.valid.split(","),function(b){a.validate(f.$modelValue,b,g),c.$watch(function(){return f.$modelValue},function(c){a.validate({value:c},b,g)},!0),f.$parsers.push(function(c){return a.validate({value:c},b,g),c})}),c.config.expdate&&e.$observe("expdate",function(b){a.validate({value:b,expdate:c.model[c.config.expdate]},"exp_date",g)})}}}]),angular.module("mx.checkout").filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),angular.module("mx.checkout").provider("mxCheckout",function(){var a={panelClass:"panel-checkout",alertDangerClass:"alert-checkout-danger",formControlClass:"form-control-checkout"},b={};return{options:function(a){angular.extend(b,a)},$get:["mxCheckoutConfig","mxModal","$q",function(c,d,e){function f(){angular.forEach(q.config.fields,function(a){a.formControlClass=q.options.formControlClass}),g()}function g(){q.loading=!0,h().then(function(a){angular.merge(q,q.config.defaultData,a),q.tabs[q.active_tab].open=!0,q.loading=!1},function(a){q.loading=!1})}function h(){var a=e.defer();return setTimeout(function(){a.resolve(q.config.getData)},500),a.promise}function i(a,b,c){var d=n();if(q.formCtrl[d].$valid)a({formMap:q[d]}),"card"===d&&p(b);else if("card"===d){var e=!0;angular.forEach(q.config.formMap,function(a){q.formCtrl[d][a].$invalid&&(e?(e=!1,q.valid.autoFocus[a]=+new Date,q.valid.iconShow[a]=!1):q.valid.iconShow[a]=!0)}),c&&o("Please verify that all card information you've provided is accurate and try again")}}function j(a){a.$invalid&&(q.valid.iconShow[a.$name]=!0)}function k(a){a.$invalid&&(q.valid.iconShow[a.$name]=!1)}function l(a,b){a.selected=b,q[a.id].type=b}function m(a){a.preventDefault(),a.stopPropagation()}function n(){var a;return angular.forEach(q.tabs,function(b){b.open&&(a=b.id)}),a}function o(a,b){q.alert={text:a,type:b||q.options.alertDangerClass}}function p(a){d.open({title:"Title",text:"Text",type:"success"},a).result.then(function(){},function(){})}var q={options:angular.extend({},a,b),config:c,formCtrl:{},card:{},emoney:{},ibank:{},loading:!0,alert:{},valid:{errorText:{},iconShow:{},autoFocus:{}}};return{data:q,init:f,formSubmit:i,stop:m,blur:j,focus:k,selectPaymentSystems:l}}]}}).factory("mxValidation",["mxCheckout",function(a){var b=/^[0-9]+$/,c=/^[\d\-\s]+$/,d={required:function(a){var b=a.value;return!!b},ccard:function(a){if(!c.test(a.value))return!1;for(var b=0,d=0,e=!1,f=a.value.replace(/\D/g,""),g=f.length-1;g>=0;g--){var h=f.charAt(g);d=parseInt(h,10),e&&(d*=2)>9&&(d-=9),b+=d,e=!e}return b%10===0},num:function(a){return b.test(a.value)},min_length:function(a,c){return!!b.test(c)&&a.value.length>=parseInt(c,10)},cvv2:function(a){return d.num.call(this,a)&&d.min_length.call(this,a,3)},expiry:function(a,b){var c,d;return!(!a||!b)&&(!!/^\d+$/.test(a)&&(!!/^\d+$/.test(b)&&(1<=a&&a<=12&&(2===b.length&&(b=b<70?"20"+b:"19"+b),4===b.length&&(d=new Date(b,a),c=new Date,d.setMonth(d.getMonth()-1),d.setMonth(d.getMonth()+1,1),d>c)))))},exp_date:function(b){return d.expiry.call(this,a.data.card.expireMonth,a.data.card.expireYear)}};return{validate:function(a,b,c){var e=d[b](a);return c(e,b),e}}}]).factory("mxModal",["$uibModal",function(a){return{open:function(b,c){return a.open({templateUrl:"mx/template/checkout/modal.html",controller:["$scope","$uibModalInstance",function(a,c){a.option=b,a.url=""}],appendTo:c})}}}]),angular.module("mx/template/checkout/card.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/card.html",'<form name="data.formCtrl.card" ng-submit="formSubmit()" novalidate>\n    <div class="row">\n        <div class="col-xs-12">\n            <div\n                    ng-if="data.alert.text"\n                    class="alert {{data.alert.type}}"\n                    role="alert"\n            >\n                <div class="alert-inner">{{data.alert.text}}</div>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-xs-7 col-card">\n            <div mx-field-input="data.card" config="data.config.fields.card" form-ctrl="data.formCtrl.card" blur="blur(inputCtrl)" focus="focus(inputCtrl)" valid="data.valid"></div>\n        </div>\n        <div class="col-xs-5">\n            <div class="row">\n                <div class="col-xs-6 col-expire-month">\n                    <div mx-field-input="data.card" config="data.config.fields.expireMonth"\n                         form-ctrl="data.formCtrl.card" blur="blur(inputCtrl)" focus="focus(inputCtrl)" valid="data.valid"></div>\n                </div>\n                <div class="col-xs-6 col-expire-year">\n                    <div mx-field-input="data.card" config="data.config.fields.expireYear"\n                         form-ctrl="data.formCtrl.card" blur="blur(inputCtrl)" focus="focus(inputCtrl)" valid="data.valid"></div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class="row">\n        <div class="col-xs-4 col-cvv">\n            <div mx-field-input="data.card" config="data.config.fields.cvv" form-ctrl="data.formCtrl.card" blur="blur(inputCtrl)" focus="focus(inputCtrl)" valid="data.valid"></div>\n        </div>\n    </div>\n    <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;" tabindex="-1" />\n</form>')}]),angular.module("mx/template/checkout/checkout.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/checkout.html",'<div class="loading" ng-if="data.loading">Loading...</div>\n<div ng-if="!data.loading">\n    <uib-accordion>\n        <div\n                uib-accordion-group\n                class="panel {{::data.options.panelClass}}"\n                ng-repeat="tabId in ::data.tabs_order"\n                ng-init="tab = data.tabs[tabId]"\n                is-open="tab.open"\n        >\n            <uib-accordion-heading ng-click="">\n                <span class="tab-icons">\n                    <i class="i i-{{::icon}}" ng-repeat="icon in ::tab.icons" ng-click="stop($event)"></i>\n                </span>\n                {{::tab.name}}\n            </uib-accordion-heading>\n            <div  ng-include="\'mx/template/checkout/\' + tab.id + \'.html\'"></div>\n        </div>\n    </uib-accordion>\n    <div class="lock"><i class="i i-lock"></i> Your payment info is stored securely</div>\n    <hr>\n    <div class="text-right"><button type="button" class="btn btn-primary" ng-click="formSubmit(true)">Checkout</button></div>\n</div>')}]),angular.module("mx/template/checkout/emoney.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/emoney.html",'<form name="data.formCtrl.emoney" ng-submit="formSubmit()" novalidate>\n    <div class="payment-systems form-group">\n        <div class="payment-system"\n             ng-class="{\n            active: tab.selected === id\n         }"\n             ng-repeat="(id, value) in tab.payment_systems"\n             aria-selected="{{tab.selected === id}}"\n             ng-click="selectPaymentSystems(tab, id)"\n        >\n            <div class="i-payment-system i-{{::id}}"></div>\n            <div>{{::value.name}}</div>\n        </div>\n    </div>\n    <input type="hidden" ng-model="data.ibank.type" ng-required="true">\n    <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;" tabindex="-1" />\n</form>')}]),angular.module("mx/template/checkout/field-input.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/field-input.html",'<div class="form-group"\n     ng-class="{\n                \'has-error\': valid.iconShow[config.id],\n                \'has-success\': formCtrl[config.id].$valid\n            }"\n>\n    <label\n            ng-if="::config.label"\n    ><span>{{::config.text}}&nbsp;</span>\n        <i ng-if="::config.info" class="i i-i" uib-tooltip="{{::config.info}}" tooltip-placement="right" tooltip-append-to-body="true"></i>\n    <input\n\n            name="{{::config.id}}"\n            ng-model="model[config.id]"\n            type="tel"\n            class="form-control {{::config.formControlClass}}"\n\n            placeholder="{{::config.placeholder}}"\n            ng-pattern="::config.pattern"\n\n            size="{{::config.size}}"\n            maxlength="{{::config.size}}"\n            autocomplete="off"\n            auto-focus="valid.autoFocus[config.id]"\n\n            model="model"\n            config="config"\n            mx-field-valid="valid"\n            expdate="{{model[config.expdate]}}"\n\n            ng-blur="blur({inputCtrl: formCtrl[config.id]})"\n            ng-focus="focus({inputCtrl: formCtrl[config.id]})"\n\n            uib-tooltip="{{valid.errorText[config.id]}}"\n            tooltip-placement="bottom"\n            tooltip-trigger="\'focus\'"\n            tooltip-enable="{{formCtrl[config.id].$invalid}}"\n    >\n    </label>\n</div>')}]),angular.module("mx/template/checkout/ibank.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/ibank.html",'<form name="data.formCtrl.ibank" ng-submit="formSubmit()" novalidate>\n    <div class="payment-systems form-group">\n        <div class="payment-system"\n             ng-class="{\n            active: tab.selected === id\n         }"\n             ng-repeat="(id, value) in tab.payment_systems"\n             ng-click="selectPaymentSystems(tab, id)"\n        >\n            <div class="i-payment-system i-{{::id}}"></div>\n            <div>{{::value.name}}</div>\n        </div>\n    </div>\n    <input type="hidden" ng-model="data.ibank.type" ng-required="true">\n    <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;" tabindex="-1" />\n</form>')}]),angular.module("mx/template/checkout/modal.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/modal.html",'<div class="modal-header text-{{::option.type}}">\n    <h3 class="modal-title">{{::option.title}}</h3>\n</div>\n<div class="modal-body">\n    {{::option.text}}\n    <iframe src="{{url | trusted}}" frameborder="0"></iframe>\n</div>')}])}();