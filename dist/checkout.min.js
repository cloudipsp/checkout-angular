!function(){"use strict";angular.module("mx.checkout",["mx/template/checkout/checkout.html","mx/template/checkout/card.html","mx/template/checkout/ibank.html","mx/template/checkout/emoney.html","mx/template/checkout/field-input.html","mx/template/checkout/modal.html"]),angular.module("mx.checkout").constant("mxCheckoutConfig",{fields:{card:{id:"card",text:"Card number",label:!0,size:"19",pattern:"[0-9]{14,19}",valid:"ccard,required"},expireMonth:{id:"expireMonth",placeholder:"MM",size:"2",pattern:"[0-9]{2}",valid:"exp_date,required",expdate:"expireYear"},expireYear:{id:"expireYear",placeholder:"YY",size:"2",pattern:"[0-9]{2}",valid:"exp_date,required",expdate:"expireMonth"},cvv:{id:"cvv",text:"Security Code",label:!0,info:"CVV/CVC2 – this 3-digits are security code. It is located in the signature field on the back of your payment card (last three digits)",size:"3",pattern:"[0-9]{3}",valid:"cvv2,required"}},formMap:["card","expireMonth","expireYear","cvv"],defaultData:{tabs:{card:{id:"card",icons:["visa","master","american","discover"]},emoney:{id:"emoney",icons:[]},ibank:{id:"ibank",icons:[]}}},getData:{active_tab:"card",tabs_order:["card","ibank","emoney"],tabs:{card:{name:"Credit or Debit Card"},emoney:{name:"Electronic money",payment_systems:{webmoney:{name:"Webmoney"}}},ibank:{name:"Internet-banking",payment_systems:{p24:{name:"Приват24"},plotva24:{name:"PLATBA 24"}}}}}}),angular.module("mx.checkout").directive("mxCheckout",function(){return{restrict:"A",templateUrl:"mx/template/checkout/checkout.html",scope:{onSubmit:"&"},controller:["$scope","mxCheckout","$element","$attrs",function(a,b,c,d){b.getData(),a.data=b.data,a.formSubmit=function(d){return b.formSubmit(d,a.onSubmit,c)},a.selectPaymentSystems=b.selectPaymentSystems,a.stop=b.stop}]}}).directive("mxFieldInput",function(){return{restrict:"A",replace:!0,templateUrl:"mx/template/checkout/field-input.html",scope:{model:"=mxFieldInput",config:"=",formCtrl:"="},controller:["$scope","mxCheckout",function(a,b){a.blur=b.blur,a.focus=b.focus,a.valid=b.data.valid}]}}).directive("autoFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c,d,e){b.$watch(d.autoFocus,function(b){angular.isDefined(b)&&b&&a(function(){c[0].focus()})},!0)}}}]).directive("mxFieldValid",["mxValidation","mxCheckout",function(a,b){return{restrict:"A",require:"ngModel",link:function(c,d,e,f){function g(a,d){a?b.data.valid.iconShow[c.config.expdate]=!1:b.data.valid.errorText[f.$name]="Error "+d,f.$setValidity(d,a)}c.config.valid&&angular.forEach(c.config.valid.split(","),function(b){c.$watch(function(){return f.$modelValue},function(c){a.validate(c,b,g)},!0),f.$parsers.push(function(c){return a.validate(c,b,g),c})}),c.config.expdate&&e.$observe("expdate",function(b){a.validate(b,"exp_date",g)})}}}]),angular.module("mx.checkout").filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),angular.module("mx.checkout").provider("mxCheckout",function(){var a={},b={};return{options:function(c){angular.extend(b,a,c)},$get:["mxCheckoutConfig","mxModal","$q",function(a,b,c){function d(){l.loading=!0,e().then(function(a){angular.merge(l,l.config.defaultData,a),l.tabs[l.active_tab].open=!0,l.loading=!1},function(a){l.loading=!1})}function e(){var a=c.defer();return setTimeout(function(){a.resolve(l.config.getData)},500),a.promise}function f(a,c,d){if(a.$valid)c({formMap:l[k()]}),b.open({title:"Title",text:"Text",type:"success"},d).result.then(function(){},function(){});else{var e=!0;angular.forEach(l.config.formMap,function(b){a[b].$invalid&&(e&&(e=!1,l.valid.autoFocus[b]=+new Date),l.valid.iconShow[b]=!0)})}}function g(a){a.$invalid&&(l.valid.iconShow[a.$name]=!0)}function h(a){a.$invalid&&(l.valid.iconShow[a.$name]=!1)}function i(a,b){a.selected=b,l[a.id].type=b}function j(a){a.preventDefault(),a.stopPropagation()}function k(){var a;return angular.forEach(l.tabs,function(b){b.open&&(a=b.id)}),a}var l={config:a,card:{},emoney:{},ibank:{},loading:!0,valid:{errorText:{},iconShow:{},autoFocus:{}}};return{data:l,getData:d,formSubmit:f,stop:j,blur:g,focus:h,selectPaymentSystems:i}}]}}).factory("mxValidation",["mxCheckout",function(a){var b=/^[0-9]+$/,c=/^[\d\-\s]+$/,d={required:function(a){var b=a.value;return!!b},ccard:function(a){if(!c.test(a.value))return!1;for(var b=0,d=0,e=!1,f=a.value.replace(/\D/g,""),g=f.length-1;g>=0;g--){var h=f.charAt(g);d=parseInt(h,10),e&&(d*=2)>9&&(d-=9),b+=d,e=!e}return b%10===0},num:function(a){return b.test(a.value)},min_length:function(a,c){return!!b.test(c)&&a.value.length>=parseInt(c,10)},cvv2:function(a){return d.num.call(this,a)&&d.min_length.call(this,a,3)},expiry:function(a,b){var c,d;return!(!a||!b)&&(!!/^\d+$/.test(a)&&(!!/^\d+$/.test(b)&&(1<=a&&a<=12&&(2===b.length&&(b=b<70?"20"+b:"19"+b),4===b.length&&(d=new Date(b,a),c=new Date,d.setMonth(d.getMonth()-1),d.setMonth(d.getMonth()+1,1),d>c)))))},exp_date:function(b){return d.expiry.call(this,a.data.card.expireMonth,a.data.card.expireYear)}};return{validate:function(a,b,c){var e=d[b]({value:a});return c(e,b),e}}}]).factory("mxModal",["$uibModal",function(a){return{open:function(b,c){return a.open({templateUrl:"mx/template/checkout/modal.html",controller:["$scope","$uibModalInstance",function(a,c){a.option=b,a.url=""}],appendTo:c})}}}]),angular.module("mx/template/checkout/card.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/card.html",'<div class="row">\n    <div class="col-xs-12">\n        <div ng-if="cF.$invalid && cF.$dirty" class="alert alert-danger" role="alert">Error</div>\n    </div>\n</div>\n<div class="row">\n    <div class="col-xs-7">\n        <div mx-field-input="data.card" config="data.config.fields.card" form-ctrl="cF"></div>\n    </div>\n    <div class="col-xs-5">\n        <div class="form-group has-feedback"\n             ng-class="{\n        \'has-error\': data.valid.iconShow.expireMonth || data.valid.iconShow.expireYear,\n        \'has-success\': cF.expireMonth.$valid && cF.expireYear.$valid\n    }"\n        >\n            <label class="control-label" for="expireMonth">Expiration</label>\n            <div class="form-inline">\n                <div mx-field-input="data.card" config="data.config.fields.expireMonth" form-ctrl="cF"></div>\n                <div mx-field-input="data.card" config="data.config.fields.expireYear" form-ctrl="cF"></div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="row">\n    <div class="col-xs-4">\n        <div mx-field-input="data.card" config="data.config.fields.cvv" form-ctrl="cF"></div>\n    </div>\n</div>')}]),angular.module("mx/template/checkout/checkout.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/checkout.html",'<div class="loading" ng-if="data.loading">Loading...</div>\n<form ng-if="!data.loading" name="cF" ng-submit="formSubmit(cF)" novalidate>\n    <uib-accordion>\n        <div\n                uib-accordion-group\n                class="panel-default"\n                ng-repeat="tabId in ::data.tabs_order"\n                ng-init="tab = data.tabs[tabId]"\n                is-open="tab.open"\n        >\n            <uib-accordion-heading ng-click="">\n                <span class="pull-right">\n                    <i class="i i-{{::icon}}" ng-repeat="icon in ::tab.icons" ng-click="stop($event)"></i>\n                </span>\n                <span class="title">{{::tab.name}}</span>\n            </uib-accordion-heading>\n            <div  ng-include="\'mx/template/checkout/\' + tab.id + \'.html\'"></div>\n        </div>\n    </uib-accordion>\n    <div><i class="glyphicon glyphicon-lock"></i> Your payment info is stored securely</div>\n    <hr>\n    <div class="text-right"><button type="submit" class="btn btn-primary btn-lg">Checkout</button></div>\n</form>')}]),angular.module("mx/template/checkout/emoney.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/emoney.html",'<div class="payment-systems form-group">\n    <div class="payment-system"\n         ng-class="{\n            active: tab.selected === id\n         }"\n         ng-repeat="(id, value) in tab.payment_systems"\n         aria-selected="{{tab.selected === id}}"\n         ng-click="selectPaymentSystems(tab, id)"\n    >\n        <div class="i-payment-system i-{{::id}}"></div>\n        <div>{{::value.name}}</div>\n    </div>\n</div>')}]),angular.module("mx/template/checkout/field-input.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/field-input.html",'<!--form-group-lg-->\n<!--formCtrl[config.id].$invalid && formCtrl[config.id].$touched-->\n<div class="form-group has-feedback"\n     ng-class="{\n                \'has-error\': valid.iconShow[config.id],\n                \'has-success\': formCtrl[config.id].$valid\n            }"\n>\n    <label\n            class="control-label"\n            for="{{::config.id}}"\n            ng-if="::config.label"\n    >{{::config.text}}</label>\n    <i ng-if="::config.info" class="glyphicon glyphicon-info-sign" uib-tooltip="{{::config.info}}" tooltip-placement="right" tooltip-append-to-body="true"></i>\n    <!--input-group-lg-->\n    <div class="" ng-class="::{\'input-group\': config.icon}">\n        <span ng-if="::config.icon" class="input-group-addon"><i class="glyphicon {{::config.icon}}"></i></span>\n        <input\n                id="{{::config.id}}"\n                name="{{::config.id}}"\n                ng-model="model[config.id]"\n                type="tel"\n                class="form-control"\n                placeholder="{{::config.placeholder}}"\n                ng-pattern="::config.pattern"\n\n                size="{{::config.size}}"\n                maxlength="{{::config.size}}"\n                autocomplete="off"\n                auto-focus="valid.autoFocus[config.id]"\n\n                mx-field-valid="config"\n                expdate="{{model[config.expdate]}}"\n\n                ng-blur="blur(formCtrl[config.id])"\n                ng-focus="focus(formCtrl[config.id])"\n\n                uib-tooltip="{{valid.errorText[config.id]}}"\n                tooltip-placement="bottom"\n                tooltip-trigger="\'focus\'"\n                tooltip-enable="{{formCtrl[config.id].$invalid}}"\n        >\n    </div>\n    <!--&& formCtrl[config.id].$touched-->\n    <span class="glyphicon glyphicon-exclamation-sign form-control-feedback"\n          ng-if="valid.iconShow[config.id]"\n    ></span>\n    <span class="glyphicon glyphicon-ok form-control-feedback" ng-if="formCtrl[config.id].$valid"></span>\n</div>')}]),angular.module("mx/template/checkout/ibank.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/ibank.html",'<div class="payment-systems form-group">\n    <div class="payment-system"\n         ng-class="{\n            active: tab.selected === id\n         }"\n         ng-repeat="(id, value) in tab.payment_systems"\n         aria-selected="{{tab.selected === id}}"\n         ng-click="selectPaymentSystems(tab, id)"\n    >\n        <div class="i-payment-system i-{{::id}}"></div>\n        <div>{{::value.name}}</div>\n    </div>\n</div>')}]),angular.module("mx/template/checkout/modal.html",[]).run(["$templateCache",function(a){a.put("mx/template/checkout/modal.html",'<div class="modal-header text-{{::option.type}}">\n    <h3 class="modal-title">{{::option.title}}</h3>\n</div>\n<div class="modal-body">\n    {{::option.text}}\n    <iframe src="{{url | trusted}}" frameborder="0"></iframe>\n</div>')}])}();